---
layout: post
title: 이어드림스쿨 | 데이터베이스 정규화
categories: 
  - learning
  - courses 
tags : db
excerpt_separator: <!--more-->
hide_last_modified: true
sitemap: true
---
* toc
{:toc .large-only}
이어드림스쿨 SQL 강의와 수강하며 배운 내용을 정리한 글입니다. 

관계형 데이터베이스의 정의와 이상 현상, 함수 종속성과 정규화(1NF~5NF)의 개념을 정리하였으며, 각 정규형의 조건과 실습 예제를 함께 포함하고 반정규화의 필요성과 상황도 함께 설명하였습니다

<!--more-->

## 데이터모델링

### 이상현상 

잘못 된 데이터베이스 설계로 발생하는 오류

1. **삽입이상** : 새로운 데이터를 삽입하려 할 때, 불필요한 다른 정보도 함께 입력해야만 저장이 가능한 현상<br>**ex)** 학생 테이블에 수강 정보를 같이 저장할 경우, 아직 수강하지 않은 학생은 등록이 불가능함
2. **갱신이상** : 중복된 데이터 중 일부만 수정되어 데이터 간 불일치가 발생하는 현상<br>**ex)** 한 교수의 연락처가 여러 행에 중복되어 있을 경우, 한 곳만 수정하면 나머지는 옛 정보로 남게 됨
3. **삭제이상** : 한 데이터를 삭제하려 할 때 의도치 않게 관련된 다른 중요한 데이터까지 함께 삭제되는 현상<br>**ex)** 특정 학생의 마지막 수강 과목 정보를 삭제하면서 해당 학생의 정보도 같이 사라지는 경우

### 함수의 종속성 

어떤 속성 X의 한 값이 다른 속성 Y에 속한 하나의 값에만 매핑되는 경우를 말하며, X를 `결정자` Y를 `종속자`라고한다.

즉, **속성 X의 값이 정해지면, 속성 Y의 값도 유일하게 결정되는 관계**로 이때 "X가 Y를 함수적으로 결정한다"고 표현하며, 수학적으로는 `X → Y`로 나타낸다.완전 함수 종속, 부분 함수 종속, 이행 함수 종속 등이 있으며 함수 족송성에 대해 알아야 이상현상을 제거하기 위한 정규화의 이해가 가능하다.

## 정규화

![image-20250408115811397](../../../images/2025-04-08-lecture_db (copy)/image-20250408115811397.png)

이상현상을 제거하기 위해 데이터베이스를 구조화하는 과정이다. **테이블을 작게 나누고, 데이터 간 관계를 명확히하는 과정**으로 각 데이터 간의 종속성을 제거하여 중복되는 데이터를 줄이고, 데이터의 일관성과 무결성을 보장한다.

 | 용어                                          | 정의                                                         |
   | --------------------------------------------- | ------------------------------------------------------------ |
   | **정규화 (Normalization)**                    | DBMS 테이블의 삽입, 삭제, 수정 과정에서 이상 현상의 발생을 최소화하기 위해 작은 단위의 테이블로 나눠가는 과정 |
   | **정규형 (NF: Normal Form)**                  | 정규화에 의해 도출된 데이터 모델이 갖춰야 할 특성을 만족하는 정규화된 결과물 |
   | **함수적 종속성 (FD: Functional Dependency)** | 칼럼 A를 알고 있으면 B를 알 수 있고, A가 변화하면 B도 변하는 경우, B는 A에 대해 함수적 종속성을 갖는다고 표현 |
   | **결정자**                                    | 함수적 종속성을 결정짓는 요소. 종속성에서의 칼럼 A           |
   | **다치종속**                                  | 결정자 컬럼 A에 의해 칼럼 B의 값을 다수 알 수 있을 때, B는 A에 다치종속되었다고 표현함 |

#### 1차 정규화 (1NF, First Normal Form)

테이블의 컬럼이 하나의 값만 갖도록 도메인을 원자값으로 설정하는 과정

 | 항목              | 내용                                                         |
  | ----------------- | ------------------------------------------------------------ |
  | **조건**          | 모든 속성의 값이 **원자값(Atomic Value)**이어야 함  → 컬럼에 배열, 리스트, 중첩 구조가 없어야 함 |
  | **목적**          | 반복 속성을 제거하고,  행과 열로 구성된 **관계형 테이블의 기본 구조**를 갖추는 것 |
  | **해결하는 문제** | 데이터 구조의 **일관성 부족** 문제를 해결                    |
  | **예시**          | 한 셀에 여러 개의 전화번호가 있는 경우:  `010-1234-5678, 010-9876-5432` → 각각 분리된 행으로 나눔 |

#### 2차 정규화 (2NF, Second Normal Form)

부분함수 종속을 제거하고 완전 함수 종속이 되도록 테이블을 분해하는 과정

> **<mark>부분함수종속</mark>**
>
> **복합 기본키**의 일부 속성에만 종속되는 종속성을 말한다. 즉, 어떤 속성 Y가 기본키 X의 **일부**에만 함수적으로 종속될 때, 이를 부분 함수 종속이라고 한다.

| 항목              | 내용                                                         |
| ----------------- | ------------------------------------------------------------ |
| **조건**          | **1NF를 만족**하고, 기본키의 **부분적 종속성 제거** → 기본키의 일부분에만 종속된 속성이 없어야 함 |
| **목적**          | **삽입 이상**, **갱신 이상** 방지                            |
| **해결하는 문제** | 데이터의 **삽입 이상**, **갱신 이상** 문제 해결              |
| **예시**          | 기본키가 `(학번, 과목코드)`인 테이블에서, `학생이름`이 **학번**에만 종속되어 있다면 → `학생(학번, 이름)` 테이블로 분리 |

**ex) 수강정보테이블**

| 학번(student_id) | 과목코드(subject_code) | 학생이름(name) | 성적(score) |
| ---------------- | ---------------------- | -------------- | ----------- |
| 2023001          | DB101                  | 홍길동         | A           |
| 2023001          | OS201                  | 홍길동         | B           |
| 2023002          | DB101                  | 김영희         | A+          |

- <u>기본키</u> : `(student_id, subject_code)`

- `score`는 기본키에 완전하게 종속된다 &rarr; 완전함수종속

- `name`은 `student_id`에만 종속되고 subject_code와는 완전히 무관하다 &rarr; 부분함수 종속

위의 경우 중복 데이터가 발생하고, 학생 이름을 변경하는 경우 모든 행을 일일이 수정해야하며 새로운 학생을 추가하려 해도 과목을 같이 입력해야 하므로 삽입 이상이 발생한다. 이 경우 부분 함수 종속성이 발생한 `name`을 다른 테이블로 분리한다. 이러한 과정을 제2정규화라고 한다.

#### 3차 정규화 (3NF, Third Normal Form)

이행 함수 종속을 제거하도록 테이블을 분해하는 과정

> **<mark>이행함수종속</mark>**
>
> 어떤 속성 A가 B를 결정하고, B가 다시 C를 결정한다면 A는 C를 이행적으로 함수 종속한다고 말한다.<br>`A → B`, `B → C` 이면, `A → C` (이행 함수 종속) <br>이 때, B와 C는 기본키가 아닌 속성이어야 한다.

| 항목              | 설명                                                         |
| ----------------- | ------------------------------------------------------------ |
| **조건**          | 제2정규형(2NF)를 만족하고, **이행적 종속성 제거**            |
| **이행적 종속성** | 기본키가 아닌 컬럼이 **다른 기본키가 아닌 컬럼에 종속**되는 경우 |
| **목적**          | 삭제 이상 방지 및 **데이터 독립성 확보**                     |
| **해결하는 문제** | **삭제 이상**, **갱신 이상**                                 |
| **예시**          | `학번 → 학과코드`, `학과코드 → 학과명` 이면, `학번 → 학과명`은 이행 종속 |

**ex) 학생 테이블**

| 학번(student_id) | 학과코드(dept_code) | 학과명(dept_name) |
| ---------------- | ------------------- | ----------------- |
| 2023001          | CSE                 | 컴퓨터공학과      |
| 2023002          | EEE                 | 전자전기공학과    |

- <u>기본키</u>: `student_id`

- `student_id → dept_code` ✅ 함수 종속

- `dept_code → dept_name` ✅ 함수 종속  
  - `student_id → dept_name` ✅ 이행 함수 종속

위 경우와 같이 이행 함수 종속이 발생하는 경우 데이터 중복이 발생할 수 있다. 혹은 학과명을 수정할 때 관련 된 모든 행을 수정해야하는 갱신 이상이 발생할 수 있고, 학과에 소속 된 학생이 한명도 없을 경우, 학과명 정보 자체가 사라질 수 있는 삭제 이상이 발생할 수 있다. 이러한 경우 <u>이행 함수 종속이 있는 속성들을 새로운 테이블로 분리</u>하여 제3정규형으로 정규화한다.

### 그 외 정규화의 조건들

#### 결정자이면서 후보키가 아닌것

어떤 **속성 A가 B를 함수적으로 결정**하지만, 이때의 **결정자 A가 후보키가 아니라면** 이는 **BCNF 위반**이다.

- 이 조건은 **BCNF(Boyce-Codd Normal Form)** 에서 해결한다.
- BCNF는 **모든 결정자가 후보키여야 한다**는 원칙을 가진다.

📌 **예시**

| 학번 | 과목명 | 교수명 |
| ---- | ------ | ------ |
| 1001 | DB     | 김교수 |
| 1002 | OS     | 이교수 |
| 1001 | OS     | 이교수 |

`학번, 과목명`이 기본키이지만 / `과목명 → 교수명`이 성립함 (과목명이 결정자)<br>그런데 `과목명`은 후보키가 아님 → **BCNF 위반**

➡ 해결 방법: `과목명-교수명` 테이블로 분리하여 정규화

#### 다치종속

어떤 속성 A가 **B와 C 각각에 독립적으로 영향을 줄 때**, 즉 `A →→ B` 그리고 `A →→ C` 인 경우를 **다치 종속**이라고 함. <br>다치 종속은 **함수 종속보다 더 강력한 관계**로, 하나의 값이 여러 개의 독립된 값을 가질 때 발생.

- **제4정규형(4NF)**에서 다치 종속을 제거하여 데이터 중복을 방지함.
- 다치 종속이 존재하고 결정자가 후보키가 아닐 경우 → 4NF 위반

📌 **예시**

| 학생 | 자격증     | 언어   |
| ---- | ---------- | ------ |
| 철수 | 정보처리사 | 파이썬 |
| 철수 | 정보처리사 | 자바   |
| 철수 | 빅데이터   | 파이썬 |
| 철수 | 빅데이터   | 자바   |

철수는 여러 자격증과 여러 언어를 가짐 → **학생 →→ 자격증**, **학생 →→ 언어**<br>자격증과 언어는 서로 독립적 → **다치 종속**

➡ 해결 방법: `학생-자격증` 테이블 / `학생-언어` 테이블로 분리

#### 조인종속

릴레이션 R이 여러 개의 릴레이션으로 분해되었을 때, 이들 릴레이션을 조인(Join)하면 **원래의 릴레이션과 정확히 같아야 하는 제약조건**. 즉, 분해된 테이블을 다시 합쳤을 때 **정보 손실 없이** 원래 테이블로 복원 가능해야 한다.

- **제5정규형(5NF)** 또는 **PJ/NF(Project-Join Normal Form)**에서 다룸

- 조인 종속이 존재하고, 그것이 후보키에 기반하지 않으면 → 5NF 위반

📌 **예시**

| 학생 | 강의 | 교수   |
| ---- | ---- | ------ |
| 철수 | DB   | 김교수 |
| 철수 | OS   | 이교수 |
| 영희 | DB   | 김교수 |
| 영희 | OS   | 이교수 |

이 테이블을 `학생-강의`, `강의-교수`, `학생-교수`로 나눌 수 있음. 그런데 이 3개를 조인했을 때 원래 테이블과 같아야 **5NF 만족**

➡ 조인 종속이 성립하지 않으면, 재구성 시 정보가 누락되거나 잘못 조합됨.

### 반정규화

정규화 된 데이터베이스의 성능을 개선하기 위해 다시 통합하여 구조를 재구성하는 과정 

정규화를 통해 테이블을 분해하면 여러 테이블을 조인할 때 성능이 크게 떨어질 수 있다. 따라서 자주 사용되는 쿼리를 고려하여, 데이터 중복을 감안해 역정규화를 하는 것이 효율적일 수 있다.

#### 테이블 반정규화

1. 테이블 병합
   - 여러개의 테이블을 하나로 합침. 데이터를 중복 저장하게 되지만 조회의 성능 향상을 기대.
2. 테이블 분할
   - 특정 테이블을 여러개의 테이블로 나누는 것을 의미한다.
     - 수직분할 : 컬럼 기준 분할 / 유독 수정이 많이 일어나는 컬럼을 구태여 분할
       ex) abcde 가 있엇는데, b만 유독 수정이 많은 경우 ab / acde 로 2개의 테이블로 분할
     - 수평분할 : 행 기준 분할 / ex) 날짜를 기준으로 칼럼은 동일하지만 10년 전 / 10년 후 분할
3. 테이블 추가
   - 특정 테이블 추가 / ex) 아예 중복된 테이블을 추가한다거나
     서버가 다른곳에 있는 테이블이, 다른 서버에서 계속 조회되는 경우 해당 서버에도 테이블추가

#### 칼럼 반정규화

1. 중복컬럼추가
   - 조인 연산으로 인한 성능 저하를 방지하기 위해 중복 칼럼을 추가하여 조인을 수행하지 않도록 함.
2. 파생컬럼추가
   - 트랜잭션이 처리되는 시점에 계산하는 값을 미리 계산할 칼럼을 따로 추가
3. 이력컬럼추가
   - 많은 데이터를 처리할 때 불특정한 날에 대한 조회나 최근 값을 조회할 때 나타날 수 있는 성능 저하방지를 위해 이력테이블에 컬럼을 추가
     ex)시작 & 종료 일자 등에 대한 칼럼을 따로 지정

#### 관계 반정규화

1. 중복관계추가
   - 여러 경로에 걸쳐 테이블 조인을 하는 경우 조인 연산 자체를 줄여서 조회 성능을 향상시키는 방법
     만약 A > B > C > D 형태로 테이블 조인이 발생한다면 A > D 가 되도록 줄이는 것
